<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SART – jsPsych v6 (3 & 8 No-Go)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- jsPsych v6 core & CSS -->
  <link rel="stylesheet" href="https://unpkg.com/jspsych@6.3.1/css/jspsych.css">
  <script src="https://unpkg.com/jspsych@6.3.1/jspsych.js"></script>

  <!-- Plugins -->
  <script src="https://unpkg.com/jspsych@6.3.1/plugins/jspsych-html-button-response.js"></script>
  <script src="https://unpkg.com/jspsych@6.3.1/plugins/jspsych-instructions.js"></script>

  <style>
    body {
      background-color: #f0f0f0;
      touch-action: manipulation;
    }
    .sart-digit {
      font-size: 80px;
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 30vh;
    }
    /* full-screen invisible button = tap anywhere */
    .jspsych-btn {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      opacity: 0;
      border: none;
      background: transparent;
    }
  </style>
</head>

<body></body>

<script>
  // ---------- BASIC CONFIG ----------
  var DIGITS = [1,2,3,4,5,6,7,8,9];
  var NOGO   = [3,8];        // your No-Go digits
  var N_TRIALS_MAIN = 50;    // keep small for testing; later you can make 300–500
  var STIM_TIME  = 250;      // ms stimulus visible
  var TRIAL_TIME = 1000;     // total ms per trial (stim + blank)

  var timeline = [];

  // ---------- INSTRUCTIONS ----------
  var instructions = {
    type: 'instructions',
    pages: [
      "<p style='font-size:20px;'>You will see digits (1–9) one after another on the screen.</p>" +
      "<p style='font-size:20px;'><strong>Tap anywhere on the screen for every digit</strong><br>" +
      "<strong>EXCEPT when the digit is <span style=\"color:red;\">3</span> or <span style=\"color:red;\">8</span>.</strong></p>" +
      "<p style='font-size:20px;'>So: Tap for 1, 2, 4, 5, 6, 7, 9.<br>Do NOT tap for 3 or 8.</p>" +
      "<p style='font-size:20px;'>Try to respond quickly and accurately.</p>"
    ],
    show_clickable_nav: true,
    button_label_next: 'Start'
  };
  timeline.push(instructions);

  // ---------- TRIAL GENERATOR ----------
  function make_trials(n, block_label) {
    var trials = [];
    for (var i = 0; i < n; i++) {
      var d = jsPsych.randomization.sampleWithoutReplacement(DIGITS, 1)[0];
      var is_nogo = NOGO.indexOf(d) > -1;

      var t = {
        type: 'html-button-response',
        stimulus: "<div class='sart-digit'>" + d + "</div>",
        choices: ['tap'],              // 1 invisible button over full screen
        stimulus_duration: STIM_TIME,
        trial_duration: TRIAL_TIME,
        data: {
          task: 'sart',
          block: block_label,
          digit: d,
          is_nogo: is_nogo
        },
        on_finish: function(data){
          var tapped = (data.response !== null);  // button index or null
          var comm = 0;
          var omis = 0;
          var corr = 0;

          if (data.is_nogo) {
            // No-Go: should NOT tap
            if (tapped) { comm = 1; corr = 0; }
            else        { corr = 1; }
          } else {
            // Go: should tap
            if (!tapped){ omis = 1; corr = 0; }
            else        { corr = 1; }
          }
          data.commission_error = comm;
          data.omission_error   = omis;
          data.correct_response = corr;
        }
      };
      trials.push(t);
    }
    return trials;
  }

  // ---------- PRACTICE (10) + MAIN (50) ----------
  timeline = timeline.concat(make_trials(10, 'practice'));
  timeline = timeline.concat(make_trials(N_TRIALS_MAIN, 'main'));

  // ---------- INIT & RUN ----------
  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      // download CSV
      jsPsych.data.get().localSave('csv', 'sart_3_8_data.csv');
      // simple thank-you screen
      document.body.innerHTML = "<h2 style='padding:20px;'>Task finished. Thank you!</h2>";
    }
  });
</script>
</html>
